"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Shinto = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_codebuild_1 = require("aws-cdk-lib/aws-codebuild");
const aws_codestarnotifications_1 = require("aws-cdk-lib/aws-codestarnotifications");
const aws_ec2_1 = require("aws-cdk-lib/aws-ec2");
const aws_ecr_1 = require("aws-cdk-lib/aws-ecr");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const aws_sns_1 = require("aws-cdk-lib/aws-sns");
const aws_sns_subscriptions_1 = require("aws-cdk-lib/aws-sns-subscriptions");
const pipelines = require("aws-cdk-lib/pipelines");
const codebuild_helper_1 = require("./codebuild-helper");
const constants_1 = require("./constants");
const stage_1 = require("./stage");
const types_1 = require("./types");
const utils_1 = require("./utils");
/**
 *
 * @class
 * @description - Continuous Integration Pipeline
 *
*/
class Shinto {
    /**
     *
     * @param props - application properties
     *
     */
    constructor(props) {
        /**
           *
           * config = {
           *  vpcId: Vpc Id, default=controlhub vpc id
           *  repository: CDK pipeline repository, default=awscloud-devsecops-codepipeline
           *  computeType: Build machine compute type, default=medium
           *  imageTag: ECR image tag, default=latest
           *  subnetType: type of Subnet, default=PRIVATE_WITH_NAT
           *  synth: {
           *    selfMutation: self-mutation feature, default=true
           *    crossAccountKeys: deploy to other regions / accounts, default=true
           *  }
           * }
           *
          */
        this._config = {
            vpcId: constants_1.ShintoConstants.CONFIG_VPCID,
            subnetType: constants_1.ShintoConstants.CONFIG_SUBNET_TYPE,
            image: {
                repository: constants_1.ShintoConstants.CONFIG_IMAGE_REPOSITORY,
                tagOrDigest: constants_1.ShintoConstants.CONFIG_IMAGE_TAG,
            },
            computeType: constants_1.ShintoConstants.CONFIG_COMPUTE_TYPE,
            synth: {
                selfMutation: constants_1.ShintoConstants.CONFIG_SELF_MUTATION,
                crossAccountKeys: constants_1.ShintoConstants.CONFIG_CROSS_ACCOUNT_KEYS,
            },
        };
        /**
         *
         * props = {
         *  metadata -  additional spec to overide application/configuratiuon attributes.
         *  tags - AWS Account level tags
         *  github = {
         *    connectionId: AWS CodeStar Connection Id, default=ca0edb72-987c-4291-a161-460392e4c886
         *    triggerOnPush: start pipeline based on new commit, default=true
         *    codeBuildCloneOutput: perform full git clone, default=true
         *  }
         * }
         *
         */
        this._props = {
            ...props,
            metadata: {
                ...props.metadata,
                PIPELINE_WORKSPACE: props.metadata?.PIPELINE_WORKSPACE || constants_1.ShintoConstants.DEFAULT_DIR,
                PROJECT_WORKSPACE: props.metadata?.PROJECT_WORKSPACE || constants_1.ShintoConstants.DEFAULT_DIR,
            },
            label: {
                ...props.label,
                environment: props.label.environment || types_1.EnvironmentType.DEV,
            },
            notification: {
                ...props.notification,
                developers: utils_1.PipelineUtils.propertyOrDefault(props.notification?.developers, []),
                pipelineEvents: utils_1.PipelineUtils.propertyOrDefault(props.notification?.pipelineEvents, constants_1.ShintoConstants.TRUE),
                stageEvents: utils_1.PipelineUtils.propertyOrDefault(props.notification?.stageEvents, constants_1.ShintoConstants.FALSE),
            },
            git: {
                ...props.git,
                triggerOnPush: utils_1.PipelineUtils.propertyOrDefault(props.git.triggerOnPush, constants_1.ShintoConstants.TRUE),
                codeBuildCloneOutput: utils_1.PipelineUtils.propertyOrDefault(props.git.codeBuildCloneOutput, constants_1.ShintoConstants.TRUE),
            },
            buildSpec: {
                ...props.buildSpec,
                type: utils_1.PipelineUtils.propertyOrDefault(props.buildSpec.type, constants_1.ShintoConstants.DEFAULT_BUILD_TYPE),
            },
        };
        this._app = new aws_cdk_lib_1.App();
        this._stack = new aws_cdk_lib_1.Stack(this._app, `${this._props.label.customer}-${this._props.label.project}-ci-pipeline`.toLowerCase(), {
            env: {
                region: props.controlHub.region || constants_1.ShintoConstants.DEFAULT_REGION,
                account: props.controlHub.account,
            },
        });
        for (const [key, value] of Object.entries(this._props.label)) {
            this.addTag(this._stack, `${key}`.toLowerCase(), `${value}`.toLowerCase());
        }
    }
    /**
     *
     * Provision CDK Pipeline
     *
    */
    stack() {
        const vpc = aws_ec2_1.Vpc.fromLookup(this._stack, 'VPCLookup', { vpcId: this._props.metadata?.CONTROLHUB_VPCID || this._config.vpcId });
        const role = new aws_iam_1.Role(this._stack, `${this._props.label.customer}-${this._props.label.project}-role`.toLowerCase(), {
            roleName: `${this._props.label.customer}-${this._props.label.project}-role`,
            assumedBy: new aws_iam_1.CompositePrincipal(new aws_iam_1.ServicePrincipal('codepipeline.amazonaws.com'), new aws_iam_1.ServicePrincipal('codebuild.amazonaws.com')),
        });
        for (let policy of constants_1.ShintoConstants.CONFIG_MANAGED_POLICY) {
            role.addManagedPolicy(aws_iam_1.ManagedPolicy.fromAwsManagedPolicyName(policy));
        }
        role.addToPrincipalPolicy(new aws_iam_1.PolicyStatement({
            actions: [
                'sts:AssumeRole',
            ],
            resources: ['arn:aws:iam::*:role/cdk-*'],
            effect: aws_iam_1.Effect.ALLOW,
        }));
        role.addToPrincipalPolicy(new aws_iam_1.PolicyStatement({
            actions: [
                'secretsmanager:GetSecretValue',
                'secretsmanager:DescribeSecret',
                'secretsmanager:ListSecrets',
                'secretsmanager:ListSecretVersionIds',
                'secretsmanager:GetResourcePolicy',
            ],
            resources: ['*'],
            effect: aws_iam_1.Effect.ALLOW,
        }));
        const input_source = pipelines.CodePipelineSource.connection(`${this._props.git.owner}/${this._props.git.repository}`, `${this._props.git.branch}`, {
            triggerOnPush: this._props.git.triggerOnPush,
            codeBuildCloneOutput: this._props.git.codeBuildCloneOutput,
            connectionArn: `arn:aws:codestar-connections:${aws_cdk_lib_1.Stack.of(this._stack).region}:${aws_cdk_lib_1.Stack.of(this._stack).account}:connection/${this._props.git.codeStarId}`,
        });
        const security_group = new aws_ec2_1.SecurityGroup(this._stack, 'SecurityGroup', {
            vpc: vpc,
            allowAllOutbound: true,
            securityGroupName: `${this._props.label.customer}-${this._props.label.project}-securitygroup`.toLowerCase(),
            description: `${this._props.label.customer}-${this._props.label.project}-securitygroup`.toLowerCase(),
        });
        security_group.addIngressRule(aws_ec2_1.Peer.ipv4(vpc.vpcCidrBlock), aws_ec2_1.Port.tcp(443));
        const notification_topic = new aws_sns_1.Topic(this._stack, 'NotificationTopic', {
            topicName: `${this._props.label.customer}-${this._props.label.project}-notification-topic`.toLowerCase(),
        });
        for (let email of this._props.notification?.developers || []) {
            notification_topic.addSubscription(new aws_sns_subscriptions_1.EmailSubscription(email));
        }
        notification_topic.grantPublish(role);
        let primary_output = `${this._props.metadata?.PIPELINE_WORKSPACE || constants_1.ShintoConstants.DEFAULT_DIR}`;
        let isPluggableEnabled = this._props.metadata?.PLUGGABLE_ENABLED || String(constants_1.ShintoConstants.TRUE);
        if (JSON.parse(isPluggableEnabled)) {
            primary_output = `${primary_output}/${this._props.metadata?.PLUGGABLE_WORKSPACE || constants_1.ShintoConstants.DEFAULT_PLUGGABLE_WORKSPACE}`;
        }
        primary_output = primary_output.concat('/cdk.out').replace('//', '/');
        let codeBuildStepProps = this.init(vpc, role, input_source, security_group);
        let pipeline = new pipelines.CodePipeline(this._stack, 'CodePipeline', {
            pipelineName: `${this._props.label.customer}-${this._props.label.project}-ci-pipeline`.toLowerCase(),
            crossAccountKeys: this._config.synth?.crossAccountKeys,
            selfMutation: this._config.synth?.selfMutation,
            synth: new pipelines.CodeBuildStep('Synth', {
                ...codeBuildStepProps,
                primaryOutputDirectory: primary_output,
                commands: [
                    ...constants_1.ShintoConstants.SYNTH_COMMANDS,
                ],
                installCommands: [
                    `cd ${this._props.metadata?.PIPELINE_WORKSPACE || constants_1.ShintoConstants.DEFAULT_DIR}`,
                    ...constants_1.ShintoConstants.SYNTH_INSTALL_COMMANDS,
                ],
                buildEnvironment: {
                    ...codeBuildStepProps.buildEnvironment,
                    environmentVariables: {
                        ...codeBuildStepProps.buildEnvironment?.environmentVariables,
                        NPM_SCOPE: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PARAMETER_STORE,
                            value: constants_1.ShintoConstants.SSM_KEY_NPM_SCOPE,
                        },
                        NPM_TOKEN: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PARAMETER_STORE,
                            value: constants_1.ShintoConstants.SSM_KEY_NPM_TOKEN,
                        },
                        NPM_REGISTRY: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PARAMETER_STORE,
                            value: constants_1.ShintoConstants.SSM_KEY_NPM_REGISTRY,
                        },
                        PLUGGABLE_BETA: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PLAINTEXT,
                            value: this._props.metadata?.PLUGGABLE_BETA || String(constants_1.ShintoConstants.FALSE),
                        },
                        PLUGGABLE_ENABLED: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PLAINTEXT,
                            value: this._props.metadata?.PLUGGABLE_ENABLED || String(constants_1.ShintoConstants.TRUE),
                        },
                        PLUGGABLE_WORKSPACE: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PLAINTEXT,
                            value: this._props.metadata?.PLUGGABLE_WORKSPACE || constants_1.ShintoConstants.DEFAULT_PLUGGABLE_WORKSPACE,
                        },
                        CUSTOM_INSTALL_SCRIPT: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PLAINTEXT,
                            value: this._props.metadata?.SYNTH_INSTALL_SCRIPT || '',
                        },
                        CUSTOM_COMMAND_SCRIPT: {
                            type: aws_codebuild_1.BuildEnvironmentVariableType.PLAINTEXT,
                            value: this._props.metadata?.SYNTH_COMMAND_SCRIPT || '',
                        },
                    },
                },
            }),
        });
        let addToCodeScanStage = [];
        let codeBuildHelper = new codebuild_helper_1.CodeBuildHelper(this._props);
        switch (this._props.buildSpec.type) {
            case types_1.BuildType.JAVA: {
                codeBuildStepProps = {
                    ...codeBuildStepProps,
                    env: {
                        ...codeBuildStepProps.env,
                        BUILD_OUTPUT: this._props.metadata?.BUILD_OUTPUT || 'true',
                        BUILD_OUTPUT_DESTINATION: this._props.metadata?.BUILD_OUTPUT_DESTINATION || 'target',
                    },
                };
                let codeBuildStep = codeBuildHelper.addJavaBuildStep(codeBuildStepProps);
                codeBuildStep.primaryOutputDirectory(`**/${this._props.metadata?.BUILD_OUTPUT_DESTINATION || 'target'}`);
                this.addToBuildStage('BuildStage', pipeline, codeBuildStep);
                codeBuildStepProps = {
                    ...codeBuildStepProps,
                    additionalInputs: {
                        BUILD_OUTPUT: codeBuildStep,
                    },
                };
                addToCodeScanStage = [
                    ...addToCodeScanStage,
                ];
                break;
            }
            case types_1.BuildType.PYTHON: {
                codeBuildStepProps = {
                    ...codeBuildStepProps,
                    env: {
                        ...codeBuildStepProps.env,
                        BUILD_OUTPUT_DESTINATION: this._props.metadata?.BUILD_OUTPUT_DESTINATION || 'dist',
                    },
                };
                let codeBuildStep = codeBuildHelper.addPythonBuildStep(codeBuildStepProps);
                codeBuildStep.primaryOutputDirectory(`**/${this._props.metadata?.BUILD_OUTPUT_DESTINATION || 'dist'}`);
                this.addToBuildStage('BuildStage', pipeline, codeBuildStep);
                addToCodeScanStage = [
                    ...addToCodeScanStage,
                ];
                break;
            }
        }
        if (addToCodeScanStage.length > 0) {
            let codescan_stage = new stage_1.CodeScanStage(this._stack, 'CodeScanStage', {
                ...this._props,
                env: {
                    region: this._props.controlHub.region || constants_1.ShintoConstants.DEFAULT_REGION,
                    account: this._props.controlHub.account,
                },
            });
            pipeline.addStage(codescan_stage, {
                pre: [
                    ...addToCodeScanStage,
                ],
            });
        }
        pipeline.buildPipeline();
        let notificationEvents = [];
        if (this._props.notification?.pipelineEvents || constants_1.ShintoConstants.FALSE) {
            notificationEvents = [
                ...constants_1.ShintoConstants.PIPELINE_NOTIFICATION_EVENTS,
            ];
        }
        if (this._props.notification?.stageEvents || constants_1.ShintoConstants.FALSE) {
            notificationEvents = [
                ...constants_1.ShintoConstants.STAGE_NOTIFICATION_EVENTS,
            ];
        }
        new aws_codestarnotifications_1.NotificationRule(this._stack, 'NotificationRule', {
            enabled: true,
            notificationRuleName: `${this._props.label.customer}-${this._props.label.project}-notification-rule`.toLowerCase(),
            detailType: aws_codestarnotifications_1.DetailType.FULL,
            events: [
                ...notificationEvents,
            ],
            source: pipeline.pipeline,
            targets: [notification_topic],
        });
        return this._stack;
    }
    /**
     *
     * Synthesize CDK Pipeline
     *
    */
    synth() {
        this.stack();
        return this._app.synth();
    }
    /**
     *
     * Add tags
     *
    */
    addTag(scope, key, value) {
        if (value != undefined && value.trim().length > 0) {
            aws_cdk_lib_1.Tags.of(scope).add(key, value);
        }
    }
    /**
     *
     * Add Build Stage
     *
    */
    addToBuildStage(id, pipeline, codeBuildStep) {
        let build = new stage_1.BuildStage(this._stack, id, {
            ...this._props,
            env: {
                region: this._props.controlHub.region || constants_1.ShintoConstants.DEFAULT_REGION,
                account: this._props.controlHub.account,
            },
        });
        pipeline.addStage(build, {
            pre: [codeBuildStep],
        });
    }
    /**
     *
     * Init CodeBuildStepProps
     *
    */
    init(vpc, role, input, securityGroup) {
        const repository = aws_ecr_1.Repository.fromRepositoryName(this._stack, 'Repository', this._config.image?.repository || constants_1.ShintoConstants.CONFIG_IMAGE_REPOSITORY);
        let codeBuildStepProps = {
            vpc: vpc,
            role: role,
            input: input,
            commands: [],
            securityGroups: [securityGroup],
            subnetSelection: vpc.selectSubnets({ subnetType: this._config.subnetType }),
            env: {
                PIPELINE_WORKSPACE: this._props.metadata?.PIPELINE_WORKSPACE || constants_1.ShintoConstants.DEFAULT_DIR,
                PROJECT_WORKSPACE: this._props.metadata?.PROJECT_WORKSPACE || constants_1.ShintoConstants.DEFAULT_DIR,
            },
            buildEnvironment: {
                computeType: this._config.computeType,
                buildImage: aws_codebuild_1.LinuxBuildImage.fromEcrRepository(repository, this._config.image?.tagOrDigest),
                privileged: constants_1.ShintoConstants.FALSE,
                environmentVariables: {
                    DEBUG: {
                        type: aws_codebuild_1.BuildEnvironmentVariableType.PLAINTEXT,
                        value: `${this._props.metadata?.DEBUG || constants_1.ShintoConstants.FALSE}`,
                    },
                },
            },
            rolePolicyStatements: [
                new aws_iam_1.PolicyStatement({
                    actions: ['sts:AssumeRole'],
                    resources: ['*'],
                    conditions: {
                        StringEquals: {
                            'iam:ResourceTag/aws-cdk:bootstrap-role': 'lookup',
                        },
                    },
                }),
            ],
        };
        return codeBuildStepProps;
    }
}
exports.Shinto = Shinto;
_a = JSII_RTTI_SYMBOL_1;
Shinto[_a] = { fqn: "@mrwconsulting/shinto.Shinto", version: "0.0.2" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2hpbnRvL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsNkNBQTJEO0FBQzNELDZEQUEwRjtBQUMxRixxRkFBcUY7QUFDckYsaURBQTJFO0FBQzNFLGlEQUFpRDtBQUNqRCxpREFBZ0k7QUFDaEksaURBQTRDO0FBQzVDLDZFQUFzRTtBQUV0RSxtREFBbUQ7QUFHbkQseURBQXFEO0FBRXJELDJDQUE4QztBQUU5QyxtQ0FBb0Q7QUFDcEQsbUNBQXFEO0FBQ3JELG1DQUF3QztBQTZEeEM7Ozs7O0VBS0U7QUFDRixNQUFhLE1BQU07SUFNakI7Ozs7T0FJRztJQUNILFlBQVksS0FBa0I7UUFDNUI7Ozs7Ozs7Ozs7Ozs7O1lBY0k7UUFDSixJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ2IsS0FBSyxFQUFFLDJCQUFlLENBQUMsWUFBWTtZQUNuQyxVQUFVLEVBQUUsMkJBQWUsQ0FBQyxrQkFBa0I7WUFDOUMsS0FBSyxFQUFFO2dCQUNMLFVBQVUsRUFBRSwyQkFBZSxDQUFDLHVCQUF1QjtnQkFDbkQsV0FBVyxFQUFFLDJCQUFlLENBQUMsZ0JBQWdCO2FBQzlDO1lBQ0QsV0FBVyxFQUFFLDJCQUFlLENBQUMsbUJBQW1CO1lBQ2hELEtBQUssRUFBRTtnQkFDTCxZQUFZLEVBQUUsMkJBQWUsQ0FBQyxvQkFBb0I7Z0JBQ2xELGdCQUFnQixFQUFFLDJCQUFlLENBQUMseUJBQXlCO2FBQzVEO1NBQ0YsQ0FBQztRQUVGOzs7Ozs7Ozs7Ozs7V0FZRztRQUNILElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWixHQUFHLEtBQUs7WUFDUixRQUFRLEVBQUU7Z0JBQ1IsR0FBRyxLQUFLLENBQUMsUUFBUTtnQkFDakIsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLFFBQVEsRUFBRSxrQkFBa0IsSUFBSSwyQkFBZSxDQUFDLFdBQVc7Z0JBQ3JGLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxRQUFR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QUMsT0FBTyxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUM7Z0JBQzFGLFVBQVUsRUFBRSwyQkFBZSxDQUFDLEtBQUs7Z0JBQ2pDLG9CQUFvQixFQUFFO29CQUNwQixLQUFLLEVBQUU7d0JBQ0wsSUFBSSxFQUFFLDRDQUE0QixDQUFDLFNBQVM7d0JBQzVDLEtBQUssRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEtBQUssSUFBSSwyQkFBZSxDQUFDLEtBQUssRUFBRTtxQkFDakU7aUJBQ0Y7YUFDRjtZQUNELG9CQUFvQixFQUFFO2dCQUNwQixJQUFJLHlCQUFlLENBQUM7b0JBQ2xCLE9BQU8sRUFBRSxDQUFDLGdCQUFnQixDQUFDO29CQUMzQixTQUFTLEVBQUUsQ0FBQyxHQUFHLENBQUM7b0JBQ2hCLFVBQVUsRUFBRTt3QkFDVixZQUFZLEVBQUU7NEJBQ1osd0NBQXdDLEVBQUUsUUFBUTt5QkFDbkQ7cUJBQ0Y7aUJBQ0YsQ0FBQzthQUNIO1NBQ0YsQ0FBQztRQUNGLE9BQU8sa0JBQWtCLENBQUM7SUFDNUIsQ0FBQzs7QUE3WEgsd0JBOFhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwLCBTdGFjaywgU3RhZ2VQcm9wcywgVGFncyB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IEJ1aWxkRW52aXJvbm1lbnRWYXJpYWJsZVR5cGUsIExpbnV4QnVpbGRJbWFnZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1jb2RlYnVpbGQnO1xuaW1wb3J0IHsgRGV0YWlsVHlwZSwgTm90aWZpY2F0aW9uUnVsZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1jb2Rlc3Rhcm5vdGlmaWNhdGlvbnMnO1xuaW1wb3J0IHsgSVZwYywgUGVlciwgUG9ydCwgU2VjdXJpdHlHcm91cCwgVnBjIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWVjMic7XG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWVjcic7XG5pbXBvcnQgeyBDb21wb3NpdGVQcmluY2lwYWwsIEVmZmVjdCwgSVJvbGUsIE1hbmFnZWRQb2xpY3ksIFBvbGljeVN0YXRlbWVudCwgUm9sZSwgU2VydmljZVByaW5jaXBhbCB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgVG9waWMgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc25zJztcbmltcG9ydCB7IEVtYWlsU3Vic2NyaXB0aW9uIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLXNucy1zdWJzY3JpcHRpb25zJztcbmltcG9ydCB7IENsb3VkQXNzZW1ibHkgfSBmcm9tICdhd3MtY2RrLWxpYi9jeC1hcGknO1xuaW1wb3J0ICogYXMgcGlwZWxpbmVzIGZyb20gJ2F3cy1jZGstbGliL3BpcGVsaW5lcyc7XG5pbXBvcnQgeyBJRmlsZVNldFByb2R1Y2VyIH0gZnJvbSAnYXdzLWNkay1saWIvcGlwZWxpbmVzJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgQ29kZUJ1aWxkSGVscGVyIH0gZnJvbSAnLi9jb2RlYnVpbGQtaGVscGVyJztcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gJy4vY29uZmlnJztcbmltcG9ydCB7IFNoaW50b0NvbnN0YW50cyB9IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IEJ1aWxkUHJvcHMsIENvbnRyb2xIdWJQcm9wcywgR2l0UHJvcHMsIExhYmVsUHJvcHMsIE5vdGlmaWNhdGlvblByb3BzIH0gZnJvbSAnLi9wcm9wcyc7XG5pbXBvcnQgeyBCdWlsZFN0YWdlLCBDb2RlU2NhblN0YWdlIH0gZnJvbSAnLi9zdGFnZSc7XG5pbXBvcnQgeyBCdWlsZFR5cGUsIEVudmlyb25tZW50VHlwZSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgUGlwZWxpbmVVdGlscyB9IGZyb20gJy4vdXRpbHMnO1xuXG4vKipcbiAqXG4gKiBAaW50ZXJmYWNlXG4gKiBAZGVzY3JpcHRpb24gLSBDREsgUGlwZWxpbmUgQ29uZmlndXJhdGlvbiBQcm9wZXJ0aWVzXG4gKlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNoaW50b1Byb3BzIGV4dGVuZHMgU3RhZ2VQcm9wcyB7XG4gIC8qKlxuICAgKlxuICAgKiBAb3B0aW9uYWwgLSBhZGRpdGlvbmFsIHNwZWMgdG8gb3ZlcmlkZSBhcHBsaWNhdGlvbi9jb25maWd1cmF0aXVvbiBhdHRyaWJ1dGVzLlxuICAgKlxuICAgKiBQSVBFTElORV9XT1JLU1BBQ0UgLSBzZXQgZGlyZWN0b3J5IGZvciBwaXBlbGluZSAoZGVmYXVsdDogLi8pXG4gICAqIFBST0pFQ1RfV09SS1NQQUNFIC0gc2V0IGRpcmVjdG9yeSBmb3IgYXBwbGljYXRpb24gKGRlZmF1bHQ6IC4vKVxuICAgKiBQTFVHR0FCTEVfRU5BQkxFRCAtIHNldCB0byB1c2UgcGx1Z2dhYmxlIHdvcmtzcGFjZSAoZGVmYXVsdDogdHJ1ZSlcbiAgICogUExVR0dBQkxFX1dPUktTUEFDRSAtIHNldCBwbHVnZ2FibGUgd29ya3NwYWNlIChkZWZhdWx0OiAucGlwZWxpbmUpXG4gICAqIFBMVUdHQUJMRV9CRVRBIC0gc2V0IHRvIHVzZSBiZXRhIHZlcnNpb24gKGRlZmF1bHQ6IGZhbHNlKVxuICAgKiBQWVRFU1RfRElSIC0gZGlyZWN0b3J5IGNvbnRhaW5pbmcgcHl0aG9uIHVuaXQtdGVzdHMgKGRlZmF1bHQ6IHRlc3RzKVxuICAgKiBDT05UUk9MSFVCX1ZQQ0lEIC0gc2V0IHZwYyBpZFxuICAgKiBTRUNVUklUWUdST1VQX05BTUUgLSBjb3JlIHNlY3VyaXR5IGdyb3VwIChkZWZhdWx0OiBjb3Jlc2cpXG4gICAqIERFQlVHIC0gZW5hYmxlIHNjcmlwdCBkZWJ1Z2dpbmcgKGRlZmF1bHQ6IGZhbHNlKVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgbWV0YWRhdGE6IHtcbiAgICogICAgREVCVUc6ICdmYWxzZSdcbiAgICogIH1cbiAgICovXG4gIHJlYWRvbmx5IG1ldGFkYXRhPzogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfTtcbiAgLyoqXG4gICAqXG4gICAqIEByZXF1aXJlZCAtIEFXUyBBY2NvdW50IGxldmVsIHRhZ3NcbiAgICpcbiAgKi9cbiAgcmVhZG9ubHkgbGFiZWw6IExhYmVsUHJvcHM7XG4gIC8qKlxuICAgKlxuICAgKiBAcmVxdWlyZWQgLSBjb250aW51b3VzIHBpcGVsaW5lIGFjY291bnRcbiAgICpcbiAgKi9cbiAgcmVhZG9ubHkgY29udHJvbEh1YjogQ29udHJvbEh1YlByb3BzO1xuICAvKipcbiAgICpcbiAgICogQG9wdGlvbmFsIC0gcGlwZWxpbmUgbm90aWZpY2F0aW9uIHJ1bGUgdGFyZ2V0XG4gICAqXG4gICovXG4gIHJlYWRvbmx5IG5vdGlmaWNhdGlvbj86IE5vdGlmaWNhdGlvblByb3BzO1xuICAvKipcbiAgICpcbiAgICogQHJlcXVpcmVkIC0gZ2l0IHJlcG9zaXRvcnkgY29uZmlndXJhdGlvbiBmb3IgcGlwZWxpbmVcbiAgICpcbiAgKi9cbiAgcmVhZG9ubHkgZ2l0OiBHaXRQcm9wcztcbiAgLyoqXG4gICAqXG4gICAqIEByZXF1aXJlZCAtIGJ1aWxkIHNwZWNpZmljYXRpb24gZm9yIGFwcGxpY2F0aW9uXG4gICAqXG4gICovXG4gIHJlYWRvbmx5IGJ1aWxkU3BlYzogQnVpbGRQcm9wcztcbn1cblxuLyoqXG4gKlxuICogQGNsYXNzXG4gKiBAZGVzY3JpcHRpb24gLSBDb250aW51b3VzIEludGVncmF0aW9uIFBpcGVsaW5lXG4gKlxuKi9cbmV4cG9ydCBjbGFzcyBTaGludG8ge1xuICBwcml2YXRlIF9hcHA6IEFwcDtcbiAgcHJpdmF0ZSBfc3RhY2s6IFN0YWNrO1xuICBwcml2YXRlIF9wcm9wczogU2hpbnRvUHJvcHM7XG4gIHByaXZhdGUgX2NvbmZpZzogQ29uZmlnO1xuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBhcHBsaWNhdGlvbiBwcm9wZXJ0aWVzXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcm9wczogU2hpbnRvUHJvcHMpIHtcbiAgICAvKipcbiAgICAgICAqXG4gICAgICAgKiBjb25maWcgPSB7XG4gICAgICAgKiAgdnBjSWQ6IFZwYyBJZCwgZGVmYXVsdD1jb250cm9saHViIHZwYyBpZFxuICAgICAgICogIHJlcG9zaXRvcnk6IENESyBwaXBlbGluZSByZXBvc2l0b3J5LCBkZWZhdWx0PWF3c2Nsb3VkLWRldnNlY29wcy1jb2RlcGlwZWxpbmVcbiAgICAgICAqICBjb21wdXRlVHlwZTogQnVpbGQgbWFjaGluZSBjb21wdXRlIHR5cGUsIGRlZmF1bHQ9bWVkaXVtXG4gICAgICAgKiAgaW1hZ2VUYWc6IEVDUiBpbWFnZSB0YWcsIGRlZmF1bHQ9bGF0ZXN0XG4gICAgICAgKiAgc3VibmV0VHlwZTogdHlwZSBvZiBTdWJuZXQsIGRlZmF1bHQ9UFJJVkFURV9XSVRIX05BVFxuICAgICAgICogIHN5bnRoOiB7XG4gICAgICAgKiAgICBzZWxmTXV0YXRpb246IHNlbGYtbXV0YXRpb24gZmVhdHVyZSwgZGVmYXVsdD10cnVlXG4gICAgICAgKiAgICBjcm9zc0FjY291bnRLZXlzOiBkZXBsb3kgdG8gb3RoZXIgcmVnaW9ucyAvIGFjY291bnRzLCBkZWZhdWx0PXRydWVcbiAgICAgICAqICB9XG4gICAgICAgKiB9XG4gICAgICAgKlxuICAgICAgKi9cbiAgICB0aGlzLl9jb25maWcgPSB7XG4gICAgICB2cGNJZDogU2hpbnRvQ29uc3RhbnRzLkNPTkZJR19WUENJRCxcbiAgICAgIHN1Ym5ldFR5cGU6IFNoaW50b0NvbnN0YW50cy5DT05GSUdfU1VCTkVUX1RZUEUsXG4gICAgICBpbWFnZToge1xuICAgICAgICByZXBvc2l0b3J5OiBTaGludG9Db25zdGFudHMuQ09ORklHX0lNQUdFX1JFUE9TSVRPUlksXG4gICAgICAgIHRhZ09yRGlnZXN0OiBTaGludG9Db25zdGFudHMuQ09ORklHX0lNQUdFX1RBRyxcbiAgICAgIH0sXG4gICAgICBjb21wdXRlVHlwZTogU2hpbnRvQ29uc3RhbnRzLkNPTkZJR19DT01QVVRFX1RZUEUsXG4gICAgICBzeW50aDoge1xuICAgICAgICBzZWxmTXV0YXRpb246IFNoaW50b0NvbnN0YW50cy5DT05GSUdfU0VMRl9NVVRBVElPTixcbiAgICAgICAgY3Jvc3NBY2NvdW50S2V5czogU2hpbnRvQ29uc3RhbnRzLkNPTkZJR19DUk9TU19BQ0NPVU5UX0tFWVMsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIHByb3BzID0ge1xuICAgICAqICBtZXRhZGF0YSAtICBhZGRpdGlvbmFsIHNwZWMgdG8gb3ZlcmlkZSBhcHBsaWNhdGlvbi9jb25maWd1cmF0aXVvbiBhdHRyaWJ1dGVzLlxuICAgICAqICB0YWdzIC0gQVdTIEFjY291bnQgbGV2ZWwgdGFnc1xuICAgICAqICBnaXRodWIgPSB7XG4gICAgICogICAgY29ubmVjdGlvbklkOiBBV1MgQ29kZVN0YXIgQ29ubmVjdGlvbiBJZCwgZGVmYXVsdD1jYTBlZGI3Mi05ODdjLTQyOTEtYTE2MS00NjAzOTJlNGM4ODZcbiAgICAgKiAgICB0cmlnZ2VyT25QdXNoOiBzdGFydCBwaXBlbGluZSBiYXNlZCBvbiBuZXcgY29tbWl0LCBkZWZhdWx0PXRydWVcbiAgICAgKiAgICBjb2RlQnVpbGRDbG9uZU91dHB1dDogcGVyZm9ybSBmdWxsIGdpdCBjbG9uZSwgZGVmYXVsdD10cnVlXG4gICAgICogIH1cbiAgICAgKiB9XG4gICAgICpcbiAgICAgKi9cbiAgICB0aGlzLl9wcm9wcyA9IHtcbiAgICAgIC4uLnByb3BzLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgLi4ucHJvcHMubWV0YWRhdGEsXG4gICAgICAgIFBJUEVMSU5FX1dPUktTUEFDRTogcHJvcHMubWV0YWRhdGE/LlBJUEVMSU5FX1dPUktTUEFDRSB8fCBTaGludG9Db25zdGFudHMuREVGQVVMVF9ESVIsXG4gICAgICAgIFBST0pFQ1RfV09SS1NQQUNFOiBwcm9wcy5tZXRhZGF0YT8uUFJPSkVDVF9XT1JLU1BBQ0UgfHwgU2hpbnRvQ29uc3RhbnRzLkRFRkFVTFRfRElSLFxuICAgICAgfSxcbiAgICAgIGxhYmVsOiB7XG4gICAgICAgIC4uLnByb3BzLmxhYmVsLFxuICAgICAgICBlbnZpcm9ubWVudDogcHJvcHMubGFiZWwuZW52aXJvbm1lbnQgfHwgRW52aXJvbm1lbnRUeXBlLkRFVixcbiAgICAgIH0sXG4gICAgICBub3RpZmljYXRpb246IHtcbiAgICAgICAgLi4ucHJvcHMubm90aWZpY2F0aW9uLFxuICAgICAgICBkZXZlbG9wZXJzOiBQaXBlbGluZVV0aWxzLnByb3BlcnR5T3JEZWZhdWx0KHByb3BzLm5vdGlmaWNhdGlvbj8uZGV2ZWxvcGVycywgW10pLFxuICAgICAgICBwaXBlbGluZUV2ZW50czogUGlwZWxpbmVVdGlscy5wcm9wZXJ0eU9yRGVmYXVsdChwcm9wcy5ub3RpZmljYXRpb24/LnBpcGVsaW5lRXZlbnRzLCBTaGludG9Db25zdGFudHMuVFJVRSksXG4gICAgICAgIHN0YWdlRXZlbnRzOiBQaXBlbGluZVV0aWxzLnByb3BlcnR5T3JEZWZhdWx0KHByb3BzLm5vdGlmaWNhdGlvbj8uc3RhZ2VFdmVudHMsIFNoaW50b0NvbnN0YW50cy5GQUxTRSksXG4gICAgICB9LFxuICAgICAgZ2l0OiB7XG4gICAgICAgIC4uLnByb3BzLmdpdCxcbiAgICAgICAgdHJpZ2dlck9uUHVzaDogUGlwZWxpbmVVdGlscy5wcm9wZXJ0eU9yRGVmYXVsdChwcm9wcy5naXQudHJpZ2dlck9uUHVzaCwgU2hpbnRvQ29uc3RhbnRzLlRSVUUpLFxuICAgICAgICBjb2RlQnVpbGRDbG9uZU91dHB1dDogUGlwZWxpbmVVdGlscy5wcm9wZXJ0eU9yRGVmYXVsdChwcm9wcy5naXQuY29kZUJ1aWxkQ2xvbmVPdXRwdXQsIFNoaW50b0NvbnN0YW50cy5UUlVFKSxcbiAgICAgIH0sXG4gICAgICBidWlsZFNwZWM6IHtcbiAgICAgICAgLi4ucHJvcHMuYnVpbGRTcGVjLFxuICAgICAgICB0eXBlOiBQaXBlbGluZVV0aWxzLnByb3BlcnR5T3JEZWZhdWx0KHByb3BzLmJ1aWxkU3BlYy50eXBlLCBTaGludG9Db25zdGFudHMuREVGQVVMVF9CVUlMRF9UWVBFKSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHRoaXMuX2FwcCA9IG5ldyBBcHAoKTtcbiAgICB0aGlzLl9zdGFjayA9IG5ldyBTdGFjayh0aGlzLl9hcHAsIGAke3RoaXMuX3Byb3BzLmxhYmVsLmN1c3RvbWVyfS0ke3RoaXMuX3Byb3BzLmxhYmVsLnByb2plY3R9LWNpLXBpcGVsaW5lYC50b0xvd2VyQ2FzZSgpLCB7XG4gICAgICBlbnY6IHtcbiAgICAgICAgcmVnaW9uOiBwcm9wcy5jb250cm9sSHViLnJlZ2lvbiB8fCBTaGludG9Db25zdGFudHMuREVGQVVMVF9SRUdJT04sXG4gICAgICAgIGFjY291bnQ6IHByb3BzLmNvbnRyb2xIdWIuYWNjb3VudCxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fcHJvcHMubGFiZWwpKSB7XG4gICAgICB0aGlzLmFkZFRhZyh0aGlzLl9zdGFjaywgYCR7a2V5fWAudG9Mb3dlckNhc2UoKSwgYCR7dmFsdWV9YC50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogUHJvdmlzaW9uIENESyBQaXBlbGluZVxuICAgKlxuICAqL1xuICBzdGFjaygpOiBTdGFjayB7XG4gICAgY29uc3QgdnBjID0gVnBjLmZyb21Mb29rdXAodGhpcy5fc3RhY2ssICdWUENMb29rdXAnLCB7IHZwY0lkOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uQ09OVFJPTEhVQl9WUENJRCB8fCB0aGlzLl9jb25maWcudnBjSWQgfSk7XG4gICAgY29uc3Qgcm9sZSA9IG5ldyBSb2xlKHRoaXMuX3N0YWNrLCBgJHt0aGlzLl9wcm9wcy5sYWJlbC5jdXN0b21lcn0tJHt0aGlzLl9wcm9wcy5sYWJlbC5wcm9qZWN0fS1yb2xlYC50b0xvd2VyQ2FzZSgpLCB7XG4gICAgICByb2xlTmFtZTogYCR7dGhpcy5fcHJvcHMubGFiZWwuY3VzdG9tZXJ9LSR7dGhpcy5fcHJvcHMubGFiZWwucHJvamVjdH0tcm9sZWAsXG4gICAgICBhc3N1bWVkQnk6IG5ldyBDb21wb3NpdGVQcmluY2lwYWwobmV3IFNlcnZpY2VQcmluY2lwYWwoJ2NvZGVwaXBlbGluZS5hbWF6b25hd3MuY29tJyksIG5ldyBTZXJ2aWNlUHJpbmNpcGFsKCdjb2RlYnVpbGQuYW1hem9uYXdzLmNvbScpKSxcbiAgICB9KTtcbiAgICBmb3IgKGxldCBwb2xpY3kgb2YgU2hpbnRvQ29uc3RhbnRzLkNPTkZJR19NQU5BR0VEX1BPTElDWSkge1xuICAgICAgcm9sZS5hZGRNYW5hZ2VkUG9saWN5KFxuICAgICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZShwb2xpY3kpLFxuICAgICAgKTtcbiAgICB9XG4gICAgcm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgJ3N0czpBc3N1bWVSb2xlJyxcbiAgICAgIF0sXG4gICAgICByZXNvdXJjZXM6IFsnYXJuOmF3czppYW06Oio6cm9sZS9jZGstKiddLFxuICAgICAgZWZmZWN0OiBFZmZlY3QuQUxMT1csXG4gICAgfSkpO1xuICAgIHJvbGUuYWRkVG9QcmluY2lwYWxQb2xpY3kobmV3IFBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbXG4gICAgICAgICdzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZScsXG4gICAgICAgICdzZWNyZXRzbWFuYWdlcjpEZXNjcmliZVNlY3JldCcsXG4gICAgICAgICdzZWNyZXRzbWFuYWdlcjpMaXN0U2VjcmV0cycsXG4gICAgICAgICdzZWNyZXRzbWFuYWdlcjpMaXN0U2VjcmV0VmVyc2lvbklkcycsXG4gICAgICAgICdzZWNyZXRzbWFuYWdlcjpHZXRSZXNvdXJjZVBvbGljeScsXG4gICAgICBdLFxuICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgIGVmZmVjdDogRWZmZWN0LkFMTE9XLFxuICAgIH0pKTtcblxuICAgIGNvbnN0IGlucHV0X3NvdXJjZSA9IHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuY29ubmVjdGlvbihgJHt0aGlzLl9wcm9wcy5naXQub3duZXJ9LyR7dGhpcy5fcHJvcHMuZ2l0LnJlcG9zaXRvcnl9YCwgYCR7dGhpcy5fcHJvcHMuZ2l0LmJyYW5jaH1gLCB7XG4gICAgICB0cmlnZ2VyT25QdXNoOiB0aGlzLl9wcm9wcy5naXQudHJpZ2dlck9uUHVzaCxcbiAgICAgIGNvZGVCdWlsZENsb25lT3V0cHV0OiB0aGlzLl9wcm9wcy5naXQuY29kZUJ1aWxkQ2xvbmVPdXRwdXQsXG4gICAgICBjb25uZWN0aW9uQXJuOiBgYXJuOmF3czpjb2Rlc3Rhci1jb25uZWN0aW9uczoke1N0YWNrLm9mKHRoaXMuX3N0YWNrKS5yZWdpb259OiR7U3RhY2sub2YodGhpcy5fc3RhY2spLmFjY291bnR9OmNvbm5lY3Rpb24vJHt0aGlzLl9wcm9wcy5naXQuY29kZVN0YXJJZH1gLFxuICAgIH0pO1xuICAgIGNvbnN0IHNlY3VyaXR5X2dyb3VwID0gbmV3IFNlY3VyaXR5R3JvdXAodGhpcy5fc3RhY2ssICdTZWN1cml0eUdyb3VwJywge1xuICAgICAgdnBjOiB2cGMsXG4gICAgICBhbGxvd0FsbE91dGJvdW5kOiB0cnVlLFxuICAgICAgc2VjdXJpdHlHcm91cE5hbWU6IGAke3RoaXMuX3Byb3BzLmxhYmVsLmN1c3RvbWVyfS0ke3RoaXMuX3Byb3BzLmxhYmVsLnByb2plY3R9LXNlY3VyaXR5Z3JvdXBgLnRvTG93ZXJDYXNlKCksXG4gICAgICBkZXNjcmlwdGlvbjogYCR7dGhpcy5fcHJvcHMubGFiZWwuY3VzdG9tZXJ9LSR7dGhpcy5fcHJvcHMubGFiZWwucHJvamVjdH0tc2VjdXJpdHlncm91cGAudG9Mb3dlckNhc2UoKSxcbiAgICB9KTtcbiAgICBzZWN1cml0eV9ncm91cC5hZGRJbmdyZXNzUnVsZShQZWVyLmlwdjQodnBjLnZwY0NpZHJCbG9jayksIFBvcnQudGNwKDQ0MykpO1xuXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uX3RvcGljID0gbmV3IFRvcGljKHRoaXMuX3N0YWNrLCAnTm90aWZpY2F0aW9uVG9waWMnLCB7XG4gICAgICB0b3BpY05hbWU6IGAke3RoaXMuX3Byb3BzLmxhYmVsLmN1c3RvbWVyfS0ke3RoaXMuX3Byb3BzLmxhYmVsLnByb2plY3R9LW5vdGlmaWNhdGlvbi10b3BpY2AudG9Mb3dlckNhc2UoKSxcbiAgICB9KTtcbiAgICBmb3IgKGxldCBlbWFpbCBvZiB0aGlzLl9wcm9wcy5ub3RpZmljYXRpb24/LmRldmVsb3BlcnMgfHwgW10pIHtcbiAgICAgIG5vdGlmaWNhdGlvbl90b3BpYy5hZGRTdWJzY3JpcHRpb24obmV3IEVtYWlsU3Vic2NyaXB0aW9uKGVtYWlsKSk7XG4gICAgfVxuICAgIG5vdGlmaWNhdGlvbl90b3BpYy5ncmFudFB1Ymxpc2gocm9sZSk7XG5cbiAgICBsZXQgcHJpbWFyeV9vdXRwdXQgPSBgJHt0aGlzLl9wcm9wcy5tZXRhZGF0YT8uUElQRUxJTkVfV09SS1NQQUNFIHx8IFNoaW50b0NvbnN0YW50cy5ERUZBVUxUX0RJUn1gO1xuICAgIGxldCBpc1BsdWdnYWJsZUVuYWJsZWQgPSB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uUExVR0dBQkxFX0VOQUJMRUQgfHwgU3RyaW5nKFNoaW50b0NvbnN0YW50cy5UUlVFKTtcbiAgICBpZiAoSlNPTi5wYXJzZShpc1BsdWdnYWJsZUVuYWJsZWQpKSB7XG4gICAgICBwcmltYXJ5X291dHB1dCA9IGAke3ByaW1hcnlfb3V0cHV0fS8ke3RoaXMuX3Byb3BzLm1ldGFkYXRhPy5QTFVHR0FCTEVfV09SS1NQQUNFIHx8IFNoaW50b0NvbnN0YW50cy5ERUZBVUxUX1BMVUdHQUJMRV9XT1JLU1BBQ0V9YDtcbiAgICB9XG4gICAgcHJpbWFyeV9vdXRwdXQgPSBwcmltYXJ5X291dHB1dC5jb25jYXQoJy9jZGsub3V0JykucmVwbGFjZSgnLy8nLCAnLycpO1xuXG4gICAgbGV0IGNvZGVCdWlsZFN0ZXBQcm9wcyA9IHRoaXMuaW5pdCh2cGMsIHJvbGUsIGlucHV0X3NvdXJjZSwgc2VjdXJpdHlfZ3JvdXApO1xuICAgIGxldCBwaXBlbGluZSA9IG5ldyBwaXBlbGluZXMuQ29kZVBpcGVsaW5lKHRoaXMuX3N0YWNrLCAnQ29kZVBpcGVsaW5lJywge1xuICAgICAgcGlwZWxpbmVOYW1lOiBgJHt0aGlzLl9wcm9wcy5sYWJlbC5jdXN0b21lcn0tJHt0aGlzLl9wcm9wcy5sYWJlbC5wcm9qZWN0fS1jaS1waXBlbGluZWAudG9Mb3dlckNhc2UoKSxcbiAgICAgIGNyb3NzQWNjb3VudEtleXM6IHRoaXMuX2NvbmZpZy5zeW50aD8uY3Jvc3NBY2NvdW50S2V5cyxcbiAgICAgIHNlbGZNdXRhdGlvbjogdGhpcy5fY29uZmlnLnN5bnRoPy5zZWxmTXV0YXRpb24sXG4gICAgICBzeW50aDogbmV3IHBpcGVsaW5lcy5Db2RlQnVpbGRTdGVwKCdTeW50aCcsIHtcbiAgICAgICAgLi4uY29kZUJ1aWxkU3RlcFByb3BzLFxuICAgICAgICBwcmltYXJ5T3V0cHV0RGlyZWN0b3J5OiBwcmltYXJ5X291dHB1dCxcbiAgICAgICAgY29tbWFuZHM6IFtcbiAgICAgICAgICAuLi5TaGludG9Db25zdGFudHMuU1lOVEhfQ09NTUFORFMsXG4gICAgICAgIF0sXG4gICAgICAgIGluc3RhbGxDb21tYW5kczogW1xuICAgICAgICAgIGBjZCAke3RoaXMuX3Byb3BzLm1ldGFkYXRhPy5QSVBFTElORV9XT1JLU1BBQ0UgfHwgU2hpbnRvQ29uc3RhbnRzLkRFRkFVTFRfRElSfWAsXG4gICAgICAgICAgLi4uU2hpbnRvQ29uc3RhbnRzLlNZTlRIX0lOU1RBTExfQ09NTUFORFMsXG4gICAgICAgIF0sXG4gICAgICAgIGJ1aWxkRW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAuLi5jb2RlQnVpbGRTdGVwUHJvcHMuYnVpbGRFbnZpcm9ubWVudCxcbiAgICAgICAgICBlbnZpcm9ubWVudFZhcmlhYmxlczoge1xuICAgICAgICAgICAgLi4uY29kZUJ1aWxkU3RlcFByb3BzLmJ1aWxkRW52aXJvbm1lbnQ/LmVudmlyb25tZW50VmFyaWFibGVzLFxuICAgICAgICAgICAgTlBNX1NDT1BFOiB7XG4gICAgICAgICAgICAgIHR5cGU6IEJ1aWxkRW52aXJvbm1lbnRWYXJpYWJsZVR5cGUuUEFSQU1FVEVSX1NUT1JFLFxuICAgICAgICAgICAgICB2YWx1ZTogU2hpbnRvQ29uc3RhbnRzLlNTTV9LRVlfTlBNX1NDT1BFLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIE5QTV9UT0tFTjoge1xuICAgICAgICAgICAgICB0eXBlOiBCdWlsZEVudmlyb25tZW50VmFyaWFibGVUeXBlLlBBUkFNRVRFUl9TVE9SRSxcbiAgICAgICAgICAgICAgdmFsdWU6IFNoaW50b0NvbnN0YW50cy5TU01fS0VZX05QTV9UT0tFTixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBOUE1fUkVHSVNUUlk6IHtcbiAgICAgICAgICAgICAgdHlwZTogQnVpbGRFbnZpcm9ubWVudFZhcmlhYmxlVHlwZS5QQVJBTUVURVJfU1RPUkUsXG4gICAgICAgICAgICAgIHZhbHVlOiBTaGludG9Db25zdGFudHMuU1NNX0tFWV9OUE1fUkVHSVNUUlksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgUExVR0dBQkxFX0JFVEE6IHtcbiAgICAgICAgICAgICAgdHlwZTogQnVpbGRFbnZpcm9ubWVudFZhcmlhYmxlVHlwZS5QTEFJTlRFWFQsXG4gICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uUExVR0dBQkxFX0JFVEEgfHwgU3RyaW5nKFNoaW50b0NvbnN0YW50cy5GQUxTRSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgUExVR0dBQkxFX0VOQUJMRUQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogQnVpbGRFbnZpcm9ubWVudFZhcmlhYmxlVHlwZS5QTEFJTlRFWFQsXG4gICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uUExVR0dBQkxFX0VOQUJMRUQgfHwgU3RyaW5nKFNoaW50b0NvbnN0YW50cy5UUlVFKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBQTFVHR0FCTEVfV09SS1NQQUNFOiB7XG4gICAgICAgICAgICAgIHR5cGU6IEJ1aWxkRW52aXJvbm1lbnRWYXJpYWJsZVR5cGUuUExBSU5URVhULFxuICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fcHJvcHMubWV0YWRhdGE/LlBMVUdHQUJMRV9XT1JLU1BBQ0UgfHwgU2hpbnRvQ29uc3RhbnRzLkRFRkFVTFRfUExVR0dBQkxFX1dPUktTUEFDRSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBDVVNUT01fSU5TVEFMTF9TQ1JJUFQ6IHtcbiAgICAgICAgICAgICAgdHlwZTogQnVpbGRFbnZpcm9ubWVudFZhcmlhYmxlVHlwZS5QTEFJTlRFWFQsXG4gICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uU1lOVEhfSU5TVEFMTF9TQ1JJUFQgfHwgJycsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgQ1VTVE9NX0NPTU1BTkRfU0NSSVBUOiB7XG4gICAgICAgICAgICAgIHR5cGU6IEJ1aWxkRW52aXJvbm1lbnRWYXJpYWJsZVR5cGUuUExBSU5URVhULFxuICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fcHJvcHMubWV0YWRhdGE/LlNZTlRIX0NPTU1BTkRfU0NSSVBUIHx8ICcnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBsZXQgYWRkVG9Db2RlU2NhblN0YWdlOiBwaXBlbGluZXMuQ29kZUJ1aWxkU3RlcFtdID0gW107XG4gICAgbGV0IGNvZGVCdWlsZEhlbHBlciA9IG5ldyBDb2RlQnVpbGRIZWxwZXIodGhpcy5fcHJvcHMpO1xuICAgIHN3aXRjaCAodGhpcy5fcHJvcHMuYnVpbGRTcGVjLnR5cGUpIHtcbiAgICAgIGNhc2UgQnVpbGRUeXBlLkpBVkE6IHtcbiAgICAgICAgY29kZUJ1aWxkU3RlcFByb3BzID0ge1xuICAgICAgICAgIC4uLmNvZGVCdWlsZFN0ZXBQcm9wcyxcbiAgICAgICAgICBlbnY6IHtcbiAgICAgICAgICAgIC4uLmNvZGVCdWlsZFN0ZXBQcm9wcy5lbnYsXG4gICAgICAgICAgICBCVUlMRF9PVVRQVVQ6IHRoaXMuX3Byb3BzLm1ldGFkYXRhPy5CVUlMRF9PVVRQVVQgfHwgJ3RydWUnLFxuICAgICAgICAgICAgQlVJTERfT1VUUFVUX0RFU1RJTkFUSU9OOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uQlVJTERfT1VUUFVUX0RFU1RJTkFUSU9OIHx8ICd0YXJnZXQnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIGxldCBjb2RlQnVpbGRTdGVwID0gY29kZUJ1aWxkSGVscGVyLmFkZEphdmFCdWlsZFN0ZXAoY29kZUJ1aWxkU3RlcFByb3BzKTtcbiAgICAgICAgY29kZUJ1aWxkU3RlcC5wcmltYXJ5T3V0cHV0RGlyZWN0b3J5KGAqKi8ke3RoaXMuX3Byb3BzLm1ldGFkYXRhPy5CVUlMRF9PVVRQVVRfREVTVElOQVRJT04gfHwgJ3RhcmdldCd9YCk7XG5cbiAgICAgICAgdGhpcy5hZGRUb0J1aWxkU3RhZ2UoJ0J1aWxkU3RhZ2UnLCBwaXBlbGluZSwgY29kZUJ1aWxkU3RlcCk7XG4gICAgICAgIGNvZGVCdWlsZFN0ZXBQcm9wcyA9IHtcbiAgICAgICAgICAuLi5jb2RlQnVpbGRTdGVwUHJvcHMsXG4gICAgICAgICAgYWRkaXRpb25hbElucHV0czoge1xuICAgICAgICAgICAgQlVJTERfT1VUUFVUOiBjb2RlQnVpbGRTdGVwLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICAgIGFkZFRvQ29kZVNjYW5TdGFnZSA9IFtcbiAgICAgICAgICAuLi5hZGRUb0NvZGVTY2FuU3RhZ2UsXG4gICAgICAgIF07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBCdWlsZFR5cGUuUFlUSE9OOiB7XG4gICAgICAgIGNvZGVCdWlsZFN0ZXBQcm9wcyA9IHtcbiAgICAgICAgICAuLi5jb2RlQnVpbGRTdGVwUHJvcHMsXG4gICAgICAgICAgZW52OiB7XG4gICAgICAgICAgICAuLi5jb2RlQnVpbGRTdGVwUHJvcHMuZW52LFxuICAgICAgICAgICAgQlVJTERfT1VUUFVUX0RFU1RJTkFUSU9OOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uQlVJTERfT1VUUFVUX0RFU1RJTkFUSU9OIHx8ICdkaXN0JyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICBsZXQgY29kZUJ1aWxkU3RlcCA9IGNvZGVCdWlsZEhlbHBlci5hZGRQeXRob25CdWlsZFN0ZXAoY29kZUJ1aWxkU3RlcFByb3BzKTtcbiAgICAgICAgY29kZUJ1aWxkU3RlcC5wcmltYXJ5T3V0cHV0RGlyZWN0b3J5KGAqKi8ke3RoaXMuX3Byb3BzLm1ldGFkYXRhPy5CVUlMRF9PVVRQVVRfREVTVElOQVRJT04gfHwgJ2Rpc3QnfWApO1xuXG4gICAgICAgIHRoaXMuYWRkVG9CdWlsZFN0YWdlKCdCdWlsZFN0YWdlJywgcGlwZWxpbmUsIGNvZGVCdWlsZFN0ZXApO1xuICAgICAgICBhZGRUb0NvZGVTY2FuU3RhZ2UgPSBbXG4gICAgICAgICAgLi4uYWRkVG9Db2RlU2NhblN0YWdlLFxuICAgICAgICBdO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYWRkVG9Db2RlU2NhblN0YWdlLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBjb2Rlc2Nhbl9zdGFnZSA9IG5ldyBDb2RlU2NhblN0YWdlKHRoaXMuX3N0YWNrLCAnQ29kZVNjYW5TdGFnZScsIHtcbiAgICAgICAgLi4udGhpcy5fcHJvcHMsXG4gICAgICAgIGVudjoge1xuICAgICAgICAgIHJlZ2lvbjogdGhpcy5fcHJvcHMuY29udHJvbEh1Yi5yZWdpb24gfHwgU2hpbnRvQ29uc3RhbnRzLkRFRkFVTFRfUkVHSU9OLFxuICAgICAgICAgIGFjY291bnQ6IHRoaXMuX3Byb3BzLmNvbnRyb2xIdWIuYWNjb3VudCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgcGlwZWxpbmUuYWRkU3RhZ2UoY29kZXNjYW5fc3RhZ2UsIHtcbiAgICAgICAgcHJlOiBbXG4gICAgICAgICAgLi4uYWRkVG9Db2RlU2NhblN0YWdlLFxuICAgICAgICBdLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcGlwZWxpbmUuYnVpbGRQaXBlbGluZSgpO1xuXG4gICAgbGV0IG5vdGlmaWNhdGlvbkV2ZW50czogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAodGhpcy5fcHJvcHMubm90aWZpY2F0aW9uPy5waXBlbGluZUV2ZW50cyB8fCBTaGludG9Db25zdGFudHMuRkFMU0UpIHtcbiAgICAgIG5vdGlmaWNhdGlvbkV2ZW50cyA9IFtcbiAgICAgICAgLi4uU2hpbnRvQ29uc3RhbnRzLlBJUEVMSU5FX05PVElGSUNBVElPTl9FVkVOVFMsXG4gICAgICBdO1xuICAgIH1cbiAgICBpZiAodGhpcy5fcHJvcHMubm90aWZpY2F0aW9uPy5zdGFnZUV2ZW50cyB8fCBTaGludG9Db25zdGFudHMuRkFMU0UpIHtcbiAgICAgIG5vdGlmaWNhdGlvbkV2ZW50cyA9IFtcbiAgICAgICAgLi4uU2hpbnRvQ29uc3RhbnRzLlNUQUdFX05PVElGSUNBVElPTl9FVkVOVFMsXG4gICAgICBdO1xuICAgIH1cbiAgICBuZXcgTm90aWZpY2F0aW9uUnVsZSh0aGlzLl9zdGFjaywgJ05vdGlmaWNhdGlvblJ1bGUnLCB7XG4gICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgbm90aWZpY2F0aW9uUnVsZU5hbWU6IGAke3RoaXMuX3Byb3BzLmxhYmVsLmN1c3RvbWVyfS0ke3RoaXMuX3Byb3BzLmxhYmVsLnByb2plY3R9LW5vdGlmaWNhdGlvbi1ydWxlYC50b0xvd2VyQ2FzZSgpLFxuICAgICAgZGV0YWlsVHlwZTogRGV0YWlsVHlwZS5GVUxMLFxuICAgICAgZXZlbnRzOiBbXG4gICAgICAgIC4uLm5vdGlmaWNhdGlvbkV2ZW50cyxcbiAgICAgIF0sXG4gICAgICBzb3VyY2U6IHBpcGVsaW5lLnBpcGVsaW5lLFxuICAgICAgdGFyZ2V0czogW25vdGlmaWNhdGlvbl90b3BpY10sXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuX3N0YWNrO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIFN5bnRoZXNpemUgQ0RLIFBpcGVsaW5lXG4gICAqXG4gICovXG4gIHN5bnRoKCk6IENsb3VkQXNzZW1ibHkge1xuICAgIHRoaXMuc3RhY2soKTtcbiAgICByZXR1cm4gdGhpcy5fYXBwLnN5bnRoKCk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQWRkIHRhZ3NcbiAgICpcbiAgKi9cbiAgYWRkVGFnKHNjb3BlOiBDb25zdHJ1Y3QsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCAmJiB2YWx1ZS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgICAgVGFncy5vZihzY29wZSkuYWRkKGtleSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBBZGQgQnVpbGQgU3RhZ2VcbiAgICpcbiAgKi9cbiAgYWRkVG9CdWlsZFN0YWdlKGlkOiBzdHJpbmcsIHBpcGVsaW5lOiBwaXBlbGluZXMuQ29kZVBpcGVsaW5lLCBjb2RlQnVpbGRTdGVwOiBwaXBlbGluZXMuQ29kZUJ1aWxkU3RlcCkge1xuICAgIGxldCBidWlsZCA9IG5ldyBCdWlsZFN0YWdlKHRoaXMuX3N0YWNrLCBpZCwge1xuICAgICAgLi4udGhpcy5fcHJvcHMsXG4gICAgICBlbnY6IHtcbiAgICAgICAgcmVnaW9uOiB0aGlzLl9wcm9wcy5jb250cm9sSHViLnJlZ2lvbiB8fCBTaGludG9Db25zdGFudHMuREVGQVVMVF9SRUdJT04sXG4gICAgICAgIGFjY291bnQ6IHRoaXMuX3Byb3BzLmNvbnRyb2xIdWIuYWNjb3VudCxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UoYnVpbGQsIHtcbiAgICAgIHByZTogW2NvZGVCdWlsZFN0ZXBdLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEluaXQgQ29kZUJ1aWxkU3RlcFByb3BzXG4gICAqXG4gICovXG4gIGluaXQodnBjOiBJVnBjLCByb2xlOiBJUm9sZSwgaW5wdXQ6IElGaWxlU2V0UHJvZHVjZXIsIHNlY3VyaXR5R3JvdXA6IFNlY3VyaXR5R3JvdXApOiBwaXBlbGluZXMuQ29kZUJ1aWxkU3RlcFByb3BzIHtcbiAgICBjb25zdCByZXBvc2l0b3J5ID0gUmVwb3NpdG9yeS5mcm9tUmVwb3NpdG9yeU5hbWUodGhpcy5fc3RhY2ssICdSZXBvc2l0b3J5JywgdGhpcy5fY29uZmlnLmltYWdlPy5yZXBvc2l0b3J5IHx8IFNoaW50b0NvbnN0YW50cy5DT05GSUdfSU1BR0VfUkVQT1NJVE9SWSk7XG4gICAgbGV0IGNvZGVCdWlsZFN0ZXBQcm9wczogcGlwZWxpbmVzLkNvZGVCdWlsZFN0ZXBQcm9wcyA9IHtcbiAgICAgIHZwYzogdnBjLFxuICAgICAgcm9sZTogcm9sZSxcbiAgICAgIGlucHV0OiBpbnB1dCxcbiAgICAgIGNvbW1hbmRzOiBbXSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbc2VjdXJpdHlHcm91cF0sXG4gICAgICBzdWJuZXRTZWxlY3Rpb246IHZwYy5zZWxlY3RTdWJuZXRzKHsgc3VibmV0VHlwZTogdGhpcy5fY29uZmlnLnN1Ym5ldFR5cGUgfSksXG4gICAgICBlbnY6IHtcbiAgICAgICAgUElQRUxJTkVfV09SS1NQQUNFOiB0aGlzLl9wcm9wcy5tZXRhZGF0YT8uUElQRUxJTkVfV09SS1NQQUNFIHx8IFNoaW50b0NvbnN0YW50cy5ERUZBVUxUX0RJUixcbiAgICAgICAgUFJPSkVDVF9XT1JLU1BBQ0U6IHRoaXMuX3Byb3BzLm1ldGFkYXRhPy5QUk9KRUNUX1dPUktTUEFDRSB8fCBTaGludG9Db25zdGFudHMuREVGQVVMVF9ESVIsXG4gICAgICB9LFxuICAgICAgYnVpbGRFbnZpcm9ubWVudDoge1xuICAgICAgICBjb21wdXRlVHlwZTogdGhpcy5fY29uZmlnLmNvbXB1dGVUeXBlLFxuICAgICAgICBidWlsZEltYWdlOiBMaW51eEJ1aWxkSW1hZ2UuZnJvbUVjclJlcG9zaXRvcnkocmVwb3NpdG9yeSwgdGhpcy5fY29uZmlnLmltYWdlPy50YWdPckRpZ2VzdCksXG4gICAgICAgIHByaXZpbGVnZWQ6IFNoaW50b0NvbnN0YW50cy5GQUxTRSxcbiAgICAgICAgZW52aXJvbm1lbnRWYXJpYWJsZXM6IHtcbiAgICAgICAgICBERUJVRzoge1xuICAgICAgICAgICAgdHlwZTogQnVpbGRFbnZpcm9ubWVudFZhcmlhYmxlVHlwZS5QTEFJTlRFWFQsXG4gICAgICAgICAgICB2YWx1ZTogYCR7dGhpcy5fcHJvcHMubWV0YWRhdGE/LkRFQlVHIHx8IFNoaW50b0NvbnN0YW50cy5GQUxTRX1gLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgcm9sZVBvbGljeVN0YXRlbWVudHM6IFtcbiAgICAgICAgbmV3IFBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydzdHM6QXNzdW1lUm9sZSddLFxuICAgICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdpYW06UmVzb3VyY2VUYWcvYXdzLWNkazpib290c3RyYXAtcm9sZSc6ICdsb29rdXAnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfTtcbiAgICByZXR1cm4gY29kZUJ1aWxkU3RlcFByb3BzO1xuICB9XG59Il19